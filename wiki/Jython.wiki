== Using Jython as your Expression Language ==

Full docs on the Jython language are at the official site [http://www.jython.org http://www.jython.org].

*NOTE: Jython is treated as an extension of Google Refine.  Jython / Python system path is `extensions/jython/module/MOD-INF/lib/jython` currently works with 2.0 SVN trunk build, and recently patched r1920.  This will be fixed in later 2.1 bugfix release.*

You can use almost any Python `(.py)``(.pyc)` files compatible with the bundled Jython 2.5.1 and drop them into the path. For instance, download, extract and drop in `BeautifulSoup.py` and use it to parse and extract HTML tags or content using Jython as your expression language in Google Refine.  Since Jython is essentially Java, you can even import Java libraries and utilize those!

*Remember to restart Refine*, so that new Jython/Python libraries are initialized during Butterfly's startup.

[StrippingHTML Using Jython and BeautifulSoup to handle Entity Extraction and HTML markup removal]

A few HTML parsing Python libraries to experiment with :

  # [http://docs.python.org/lib/module-HTMLParser.html HTMLParser (bundled with Jython in Refine)]
  # [http://www.crummy.com/software/BeautifulSoup/ BeautifulSoup]

A few XML parsing Python libraries:

  # [http://effbot.org/zone/element-index.htm ElementTree (bundled with Jython in Refine)]
  # [http://codespeak.net/lxml/ lxml (lxml.etree seems to offer a lot more functionality, such as XPath, XSLT, Relax NG, and XML Schema support, which ElementTree does not offer)]

----

Expressions in jython must have a `return` statement, e.g.,

{{{
  return value[1:-1]
}}}
{{{
  return rowIndex%2
}}}
Fields have to be accessed using the bracket operator rather than the dot operator

{{{
  return cells["col1"]["value"]
}}}

Accesing the Levenshtein distance between the reconciled value and the cell value (?):

{{{
  return cell["recon"]["features"]["nameLevenshtein"]
}}}

It seems as though you can make use of a wide range of Jython structures.  To return the lower case of value (if the value is not null):

{{{
  if value is not None:
    return value.lower()
  else:
    return None
}}} 