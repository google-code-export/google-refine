#summary Specification for a standard reconciliation service API.

=Introduction=

A reconciliation service is a service that, given some text which is supposedly a name of something, and any additional details, returns a ranked list of potential entities matching that name. Entities are identified by strong identifiers in some particular identifier space. For example, given the string "apple", a reconciliation service might return entities identified by "/en/apple", "/en/apple_inc", and "/en/apple_ii", in the Freebase ID space. Given the same string, another reconciliation service might return entities identified by URIs, which are in the URI space, so to speak. Some other identifier spaces are ISBN, LSID. (Although ISBN and LSID identifiers are numbers, for uniformity, they are still stored as strings in Gridworks.)

Each reconciliation service can only reconcile to one single identifier space, but several reconciliation services can reconcile to the same identifier space.

So that it will be easy for users to plug in a variety of interchangeable reconciliation services, we define the API for a standard reconciliation service here.

Note: Reconciliation in Gridworks does not have to involve calling a reconciliation service through HTTP. It might involve opening a JDBC connection to a local SQL database. However, if you implement a standard reconciliation service API, then it can be used with the existing UI in Gridworks; users only need to plug in your API's URL.

A standard reconciliation service is a HTTP-based RESTful JSON-formatted API. It operates in 2 modes: single query mode and multiple query mode. The second is for optimization (reducing number of HTTP calls).

(Much of this standard is based on the [http://api.freebase.com/api/service/search?help Freebase relevance service] and the [http://data.labs.freebase.com/recon/ Freebase experimental recon service].)

=Query Request=

==Single Query Mode==

A call to a standard reconciliation service API for a single query looks like either of these:

{{{
  http://foo.com/bar/reconcile?query=...string...
  http://foo.com/bar/reconcile?query={...json object literal...}
}}}

If the query parameter is a string, then it's an abbreviate of `query={"query":...string...}`.

The query json object literal has a few fields

|| "query" || a string to search for ||
|| "limit" || optional, an integer to specify how many results to return ||
|| "type" || optional, a single string, or an array of strings, specifying the types of result e.g., person, product, ... The actual format of each type depends on the service (e.g., "/government/policician" as a Freebase type) ||
|| "type_strict" || optional, a string, one of "any", "all", "should" ||
|| "properties" || optional, array of json object literals ||

Each json object literal of the "properties" array is of this form

{{{
  {
    "p" : string, property name, e.g., "country", or
    "pid" : string, property ID, e.g., "/people/person/nationality" in the Freebase ID space
    "v" : a single, or an array of, string or number or object literal, e.g., "Japan"
  }
}}}

A "v" object literal would have a single key "id" whose value is an identifier resolved previously to the same identity space.

Here is an example of a full query parameter:

{{{
  {
    "query" : "Ford Taurus",
    "limit" : 3,
    "type" : "/automotive/model",
    "type_strict" : "any",
    "properties" : [
      { "p" : "year", "v" : 2009 },
      { "pid" : "/automotive/model/make" , "v" : { "id" : "/en/ford" } }
    ]
  }
}}}

==Multiple Query Mode==

A call to a standard reconciliation service API for multiple queries looks like this:

{{{
  http://foo.com/bar/reconcile?queries={...json object literal...}
}}}

The json object literal has zero or more arbitrary key, each of which has a value in the same format as a single query, e.g.

{{{
  http://foo.com/bar/reconcile?queries={ "q1" : { "query" : "foo" }, "q2" : { "query" : "bar" } }
}}}

"q1" and "q2" can be arbitrary strings. 


=Query Response=

The response for a single query is a json literal object

{{{
  {
    "result" : [
      {
        "id" : ... string, database ID ...
        "name" : ... string ...
        "type" : ... array of strings ...
        "score" : ... double ...
        "match" : ... boolean, true if the service is quite confident about the match ...
      },
      ... more results ...
    ],
    ... potentially some useful envelope data, such as timing stats ...
  }
}}}

For multiple queries, the response is a json literal object with the same keys as in the request

{{{
  {
    "q1" : {
      "result" : { ... }
    },
    "q2" : {
      "result" : { ... }
    }
  }
}}}

The service should also support JSONP through a callback parameter.


=Service Metadata=

When a service is called without any parameter (or with just a callback parameter), then it returns its metadata as a json object literal with at least 3 fields "name", "identifierSpace", and "schemaSpace". Other fields are optional.

{{{
{
  "name" : "Netflix Reconciliation through Freebase",
  "identifierSpace" : "http://rdf.freebase.com/ns/authority.netflix.movie",
  "schemaSpace" : "http://rdf.freebase.com/ns/type.object.id",
  "view" : {
    "url" : "http://www.netflix.com/WiMovie//{{id}}"
  },
  "preview" : {
    "url" : "http://netflix-reconcile.freebaseapps.com/preview/{{id}}",
    "width" : 430,
    "height" : 300
  },
  "suggest" : {
    "type" : {
      "service_url" : "http://netflix-reconcile.freebaseapps.com",
      "service_path" : "/suggest_type",
      "flyout_service_url" : "http://www.freebase.com"
    },
    "property" : {
      "service_url" : "http://netflix-reconcile.freebaseapps.com",
      "service_path" : "/suggest_property",
      "flyout_service_url" : "http://www.freebase.com"
    },
    "entity" : {
      "service_url" : "http://netflix-reconcile.freebaseapps.com",
      "service_path" : "/suggest",
      "flyout_service_path" : "/flyout"
    }
  },
  "defaultTypes" : []
}
}}}

Note that Freebase itself supports at least 3 identifier spaces:

  * human-friendly IDs such as /en/apple_inc
  * machine ID (mid) such as /m/0k8z
  * GUID such as #9202a8c04000641f800000000000451e (deprecated)

Thus, it's not enough to say that the identifier space is http://www.freebase.com/; we have to use the URI of the specific property (in this case, mid).

The schema space is the identifier space for types and properties. It might be different from the entities' identifier space.

The other fields are for

  * formulating URLs to a full topic page or to a small preview page for a given entity
  * customizing the suggest widgets used in various places in the reconciliation UI


=Gridworks Integration=

Gridworks' UI will include a mechanism for entering a standard reconciliation service API's URL.

Each column in Gridworks should only be reconciled against one identity space. 
